{"remainingRequest":"/home/zerohua/application/FrontEnd/tset/stu_manage_front-main/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/zerohua/application/FrontEnd/tset/stu_manage_front-main/src/views/fan/fan_review/fan_review.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/zerohua/application/FrontEnd/tset/stu_manage_front-main/src/views/fan/fan_review/fan_review.vue","mtime":1736512644885},{"path":"/home/zerohua/application/FrontEnd/tset/stu_manage_front-main/node_modules/cache-loader/dist/cjs.js","mtime":1735892181475},{"path":"/home/zerohua/application/FrontEnd/tset/stu_manage_front-main/node_modules/babel-loader/lib/index.js","mtime":1735892181655},{"path":"/home/zerohua/application/FrontEnd/tset/stu_manage_front-main/node_modules/cache-loader/dist/cjs.js","mtime":1735892181475},{"path":"/home/zerohua/application/FrontEnd/tset/stu_manage_front-main/node_modules/vue-loader/lib/index.js","mtime":1735892182047}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IGdldEZhblJldmlld3MsIGRlbGV0ZUFsYnVtUmV2aWV3LCBhZGRBbGJ1bVJldmlldyB9IGZyb20gIkAvYXBpL3JlcXVlc3QiOwppbXBvcnQgUmV2aWV3RGlhbG9nIGZyb20gIi4vUmV2aWV3RGlhbG9nLnZ1ZSI7CmltcG9ydCB7IG1hcFN0YXRlIH0gZnJvbSAidnVleCI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkZhblJldmlldyIsCiAgY29tcG9uZW50czogewogICAgUmV2aWV3RGlhbG9nLAogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHJldmlld0RhdGE6IFtdLAogICAgICBkaWFsb2dWaXNpYmxlOiBmYWxzZSwKICAgICAgc2VsZWN0ZWRSZXZpZXdzOiBbXSwKICAgIH07CiAgfSwKICBjb21wdXRlZDogewogICAgLi4ubWFwU3RhdGUoewogICAgICBmYW5JZDogKHN0YXRlKSA9PiBzdGF0ZS5mYW5JZCwgLy8g5LuOIHN0b3JlIOS4reiOt+WPluW9k+WJjeatjOi/t+eahCBmYW5JZAogICAgfSksCiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5nZXRSZXZpZXdzKCk7CiAgfSwKICBtZXRob2RzOiB7CiAgICAvLyDojrflj5bor4TorroKICAgIGdldFJldmlld3MoKSB7CiAgICAgIGdldEZhblJldmlld3ModGhpcy5mYW5JZCkudGhlbigocmVzKSA9PiB7CiAgICAgICAgbGV0IHsgcmV2aWV3cyB9ID0gcmVzLmRhdGE7CiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkocmV2aWV3cykpIHsKICAgICAgICAgIHRoaXMucmV2aWV3RGF0YSA9IHJldmlld3M7IC8vIOebtOaOpei1i+WAvAogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCdFeHBlY3RlZCBhbiBhcnJheSwgYnV0IGdvdDonLCB0eXBlb2YgcmVzLmRhdGEpOwogICAgICAgICAgdGhpcy5yZXZpZXdEYXRhID0gW107IC8vIOWmguaenOaVsOaNruagvOW8j+S4jeato+ehru+8jOiuvue9ruS4uuepuuaVsOe7hAogICAgICAgIH0KICAgICAgfSkuY2F0Y2goKGVycm9yKSA9PiB7CiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIGZldGNoIHJldmlld3M6JywgZXJyb3IpOwogICAgICAgIHRoaXMucmV2aWV3RGF0YSA9IFtdOyAvLyDlpoLmnpzor7fmsYLlpLHotKXvvIzorr7nva7kuLrnqbrmlbDnu4QKICAgICAgfSk7CiAgICB9LAogICAgLy8g5qC85byP5YyW5pel5pyf5Li6IFlZWVktTU0tREQKICAgIGZvcm1hdERhdGUoZGF0ZSkgewogICAgICBjb25zdCBkID0gbmV3IERhdGUoZGF0ZSk7CiAgICAgIGNvbnN0IHllYXIgPSBkLmdldEZ1bGxZZWFyKCk7CiAgICAgIGNvbnN0IG1vbnRoID0gKGQuZ2V0TW9udGgoKSArIDEpLnRvU3RyaW5nKCkucGFkU3RhcnQoMiwgIjAiKTsKICAgICAgY29uc3QgZGF5ID0gZC5nZXREYXRlKCkudG9TdHJpbmcoKS5wYWRTdGFydCgyLCAiMCIpOwogICAgICByZXR1cm4gYCR7eWVhcn0tJHttb250aH0tJHtkYXl9YDsKICAgIH0sCiAgICAvLyDmiZPlvIDlj5Hooajor4TorrrlvLnnqpcKICAgIG9wZW5EaWFsb2coKSB7CiAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IHRydWU7CiAgICB9LAogICAgLy8g5YWz6Zet5by556qXCiAgICBjbG9zZURpYWxvZygpIHsKICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gZmFsc2U7CiAgICB9LAogICAgLy8g5o+Q5Lqk6K+E6K66CiAgICBzdWJtaXRSZXZpZXcoZGF0YSkgewogICAgICAvLyDnlJ/miJDlvZPliY3ml6XmnJ/vvIzmoLzlvI/kuLogWVlZWS1NTS1ERAogICAgICBjb25zdCBjdXJyZW50RGF0ZSA9IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKS5zcGxpdCgnVCcpWzBdOyAvLyDmj5Dlj5YgWVlZWS1NTS1ERCDpg6jliIYKICAgICAgY29uc3QgcmV2aWV3RGF0YSA9IHsKICAgICAgICAuLi5kYXRhLAogICAgICAgIFJldmlld0RhdGU6IGN1cnJlbnREYXRlLCAvLyDmt7vliqDor4Torrrml6XmnJ8KICAgICAgfTsKCiAgICAgIGFkZEFsYnVtUmV2aWV3KHRoaXMuZmFuSWQsIGRhdGEuQWxidW1JRCwgcmV2aWV3RGF0YSkudGhlbigoKSA9PiB7CiAgICAgICAgdGhpcy4kbWVzc2FnZSh7IG1lc3NhZ2U6ICLor4Torrrlj5HooajmiJDlip8iLCB0eXBlOiAic3VjY2VzcyIgfSk7CiAgICAgICAgdGhpcy5nZXRSZXZpZXdzKCk7CiAgICAgICAgdGhpcy5jbG9zZURpYWxvZygpOwogICAgICB9KTsKICAgIH0sCiAgICAvLyDliKDpmaTor4TorroKICAgIGhhbmRsZURlbGV0ZShyZXZpZXdJZCkgewogICAgICB0aGlzLiRjb25maXJtKCLnoa7orqTliKDpmaTor6Xor4TorrrvvJ8iKQogICAgICAgIC50aGVuKCgpID0+IHsKICAgICAgICAgIGRlbGV0ZUFsYnVtUmV2aWV3KHRoaXMuZmFuSWQsIHJldmlld0lkKS50aGVuKCgpID0+IHsKICAgICAgICAgICAgdGhpcy4kbWVzc2FnZSh7IG1lc3NhZ2U6ICLliKDpmaTmiJDlip8iLCB0eXBlOiAic3VjY2VzcyIgfSk7CiAgICAgICAgICAgIHRoaXMuZ2V0UmV2aWV3cygpOwogICAgICAgICAgfSk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy4kbWVzc2FnZSh7IHR5cGU6ICJpbmZvIiwgbWVzc2FnZTogIuW3suWPlua2iOWIoOmZpCIgfSk7CiAgICAgICAgfSk7CiAgICB9LAogICAgLy8g5om56YeP5Yig6ZmkCiAgICBiYXRjaERlbGV0ZSgpIHsKICAgICAgdGhpcy4kY29uZmlybSgi56Gu6K6k5Yig6Zmk6YCJ5Lit6K+E6K6677yfIikKICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICB0aGlzLnNlbGVjdGVkUmV2aWV3cy5mb3JFYWNoKChyZXZpZXdJZCkgPT4gewogICAgICAgICAgICBkZWxldGVBbGJ1bVJldmlldyh0aGlzLmZhbklkLCByZXZpZXdJZCk7CiAgICAgICAgICB9KTsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoeyBtZXNzYWdlOiAi5om56YeP5Yig6Zmk5oiQ5YqfIiwgdHlwZTogInN1Y2Nlc3MiIH0pOwogICAgICAgICAgdGhpcy5nZXRSZXZpZXdzKCk7CiAgICAgICAgfSkKICAgICAgICAuY2F0Y2goKCkgPT4gewogICAgICAgICAgdGhpcy4kbWVzc2FnZSh7IHR5cGU6ICJpbmZvIiwgbWVzc2FnZTogIuW3suWPlua2iOWIoOmZpCIgfSk7CiAgICAgICAgfSk7CiAgICB9LAogICAgLy8g5Yi35paw6K+E6K66CiAgICByZWZyZXNoKCkgewogICAgICB0aGlzLmdldFJldmlld3MoKTsKICAgIH0sCiAgICAvLyDlpITnkIbpgInkuK3pobkKICAgIGhhbmRsZVNlbGVjdGlvbkNoYW5nZShyb3dzKSB7CiAgICAgIHRoaXMuc2VsZWN0ZWRSZXZpZXdzID0gcm93cy5tYXAoKHJvdykgPT4gcm93LlJldmlld0lEKTsKICAgIH0sCiAgfSwKfTsK"},{"version":3,"sources":["fan_review.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"fan_review.vue","sourceRoot":"src/views/fan/fan_review","sourcesContent":["<template>\n  <div class=\"fan-review\">\n    <div class=\"container_wrap\">\n      <div class=\"batchOption\">\n        <el-button icon=\"el-icon-plus\" type=\"success\" @click=\"openDialog\">发表评论</el-button>\n        <el-button icon=\"el-icon-delete\" type=\"danger\" @click=\"batchDelete\">删除选中</el-button>\n        <el-button icon=\"el-icon-refresh\" type=\"warning\" @click=\"refresh\">刷新评论</el-button>\n      </div>\n\n      <el-table :data=\"reviewData\" border @selection-change=\"handleSelectionChange\">\n        <el-table-column type=\"selection\" width=\"55\"> </el-table-column>\n        <el-table-column prop=\"ReviewID\" label=\"评论ID\" width=\"100\"> </el-table-column>\n        <el-table-column prop=\"AlbumID\" label=\"专辑ID\" width=\"100\"> </el-table-column>\n        <el-table-column prop=\"Comment\" label=\"评论内容\" width=\"200\"> </el-table-column>\n        <el-table-column prop=\"Rating\" label=\"评分\" width=\"100\"> </el-table-column>\n        <el-table-column prop=\"ReviewDate\" label=\"评论日期\" width=\"150\">\n          <template slot-scope=\"scope\">\n            <!-- 格式化日期为 YYYY-MM-DD -->\n            {{ formatDate(scope.row.ReviewDate) }}\n          </template>\n        </el-table-column>\n        <el-table-column label=\"操作\">\n          <template slot-scope=\"scope\">\n            <el-button size=\"mini\" type=\"danger\" icon=\"el-icon-delete\" @click=\"handleDelete(scope.row.ReviewID)\">删除</el-button>\n          </template>\n        </el-table-column>\n      </el-table>\n    </div>\n\n    <!-- 发表评论弹窗 -->\n    <ReviewDialog :dialogVisible=\"dialogVisible\" @closeDialog=\"closeDialog\" @submitReview=\"submitReview\"></ReviewDialog>\n  </div>\n</template>\n\n<script>\nimport { getFanReviews, deleteAlbumReview, addAlbumReview } from \"@/api/request\";\nimport ReviewDialog from \"./ReviewDialog.vue\";\nimport { mapState } from \"vuex\";\n\nexport default {\n  name: \"FanReview\",\n  components: {\n    ReviewDialog,\n  },\n  data() {\n    return {\n      reviewData: [],\n      dialogVisible: false,\n      selectedReviews: [],\n    };\n  },\n  computed: {\n    ...mapState({\n      fanId: (state) => state.fanId, // 从 store 中获取当前歌迷的 fanId\n    }),\n  },\n  created() {\n    this.getReviews();\n  },\n  methods: {\n    // 获取评论\n    getReviews() {\n      getFanReviews(this.fanId).then((res) => {\n        let { reviews } = res.data;\n        if (Array.isArray(reviews)) {\n          this.reviewData = reviews; // 直接赋值\n        } else {\n          console.error('Expected an array, but got:', typeof res.data);\n          this.reviewData = []; // 如果数据格式不正确，设置为空数组\n        }\n      }).catch((error) => {\n        console.error('Failed to fetch reviews:', error);\n        this.reviewData = []; // 如果请求失败，设置为空数组\n      });\n    },\n    // 格式化日期为 YYYY-MM-DD\n    formatDate(date) {\n      const d = new Date(date);\n      const year = d.getFullYear();\n      const month = (d.getMonth() + 1).toString().padStart(2, \"0\");\n      const day = d.getDate().toString().padStart(2, \"0\");\n      return `${year}-${month}-${day}`;\n    },\n    // 打开发表评论弹窗\n    openDialog() {\n      this.dialogVisible = true;\n    },\n    // 关闭弹窗\n    closeDialog() {\n      this.dialogVisible = false;\n    },\n    // 提交评论\n    submitReview(data) {\n      // 生成当前日期，格式为 YYYY-MM-DD\n      const currentDate = new Date().toISOString().split('T')[0]; // 提取 YYYY-MM-DD 部分\n      const reviewData = {\n        ...data,\n        ReviewDate: currentDate, // 添加评论日期\n      };\n\n      addAlbumReview(this.fanId, data.AlbumID, reviewData).then(() => {\n        this.$message({ message: \"评论发表成功\", type: \"success\" });\n        this.getReviews();\n        this.closeDialog();\n      });\n    },\n    // 删除评论\n    handleDelete(reviewId) {\n      this.$confirm(\"确认删除该评论？\")\n        .then(() => {\n          deleteAlbumReview(this.fanId, reviewId).then(() => {\n            this.$message({ message: \"删除成功\", type: \"success\" });\n            this.getReviews();\n          });\n        })\n        .catch(() => {\n          this.$message({ type: \"info\", message: \"已取消删除\" });\n        });\n    },\n    // 批量删除\n    batchDelete() {\n      this.$confirm(\"确认删除选中评论？\")\n        .then(() => {\n          this.selectedReviews.forEach((reviewId) => {\n            deleteAlbumReview(this.fanId, reviewId);\n          });\n          this.$message({ message: \"批量删除成功\", type: \"success\" });\n          this.getReviews();\n        })\n        .catch(() => {\n          this.$message({ type: \"info\", message: \"已取消删除\" });\n        });\n    },\n    // 刷新评论\n    refresh() {\n      this.getReviews();\n    },\n    // 处理选中项\n    handleSelectionChange(rows) {\n      this.selectedReviews = rows.map((row) => row.ReviewID);\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n.fan-review {\n  .batchOption {\n    margin-bottom: 5px;\n    .el-button {\n      font-size: 10px;\n      padding: 5px;\n    }\n  }\n}\n</style>\n"]}]}